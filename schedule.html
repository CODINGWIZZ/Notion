<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">

    <title>Schedule</title>
  </head>
  <body>
    <div id="message">
      <div id="classroom"></div>
      <div id="subject"></div>
      <div id="countdown"></div>
      <div id="times"></div>
    </div>
  </body>
  <script>
    $("#message").hide();

    fetch("https://codingwizz.github.io/Notion/schedule.json")
    .then(res => res.json())
    .then(data => {
      function schedule() {
        var date = new Date();
        var day = date.getDay() == 0 ? 6 : date.getDay() - 1;
  
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();
  
        var daysDifference = 0;
  
        while(!data[day]) {
          day++;
          daysDifference++;
          if(day > 6) day = 0;
  
          hours = 0;
          minutes = 0;
          seconds = 0;
        }
  
        var lessions = data[day];
  
        var timeInSeconds = hours * 60 * 60 + minutes * 60 + seconds;
  
        var map = lessions.map(data => data.start);
        var last = map[map.length - 1].split(":");
  
        var lowestNumber = parseInt(last[0]) * 60 * 60 + parseInt(last[1]) * 60;
        var lowestTime = last[0] + ":" + last[1];
        var index = 0;
  
        for(var i = 0; i < map.length; i++) {
          var result = map[i];
          var time = result.substring(0, 5);
  
          var split = time.split(":");
          var splitInSeconds = split[0] * 60 * 60 + split[1] * 60;
  
          if(splitInSeconds < lowestNumber && timeInSeconds < splitInSeconds) {
            lowestNumber = splitInSeconds;
            lowestTime = time;
  
            index = i;
          }
        }
  
        if(timeInSeconds > splitInSeconds) {
          day++;
          if(day > 6) day = 0;
  
          while(!data[day]) {
            day++;
            if(day > 6) day = 0;
          }
  
          lowestNumber = data[day][0].start;
          lowestTime = data[day][0].start;
          index = 0;
        }
  
        hours = date.getHours();
        minutes = date.getMinutes();
        seconds = date.getSeconds();
  
        var result = lessions[index];

        $("#classroom").text(result.classroom);
        $("#subject").text(result.subject);
        $("#times").text(result.start + "-" + result.end);

        return { daysDifference, lowestNumber, lowestTime };
      }

      var { daysDifference, result, lowestNumber, lowestTime } = schedule();

      function addSeconds(seconds, date = new Date()) {
        date.setTime(date.getTime() + seconds * 1000);
        return date;
      }

      var x = setInterval(function() {
        var countdownDate = null;
  
        if(daysDifference > 0) {
          var daysInSeconds = daysDifference * 24 * 60 * 60;
          var difference = daysInSeconds - lowestNumber;
  
          countdownDate = new Date(new Date(addSeconds(difference)).toISOString().split("T")[0] + "T" + lowestTime + ":00").getTime();
        } else {
          var currentDate = new Date();
          countdownDate = addSeconds(lowestNumber, currentDate.getFullYear() + "-" + currentDate.getMonth().padStart(2, "0") + "-" + currentDate.getDate().padStart(2, "0") + "T00:00:00").getTime();
        }
  
        var now = new Date().getTime();
        var difference = countdownDate - now;
  
        var countdownDays = Math.floor(difference / (1000 * 60 * 60 * 24));
        var countdownHours = Math.floor(countdownDays * 24 + (difference %  (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var countdownMinutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
        var countdownSeconds = Math.floor((difference % (1000 * 60)) / 1000);

        $("#countdown").text(countdownHours.toString().padStart(2, "0") + ":" + countdownMinutes.toString().padStart(2, "0") + ":" + countdownSeconds.toString().padStart(2, "0"));

        if(difference < 0) schedule();
      }, 1000);

      $("#message").delay(1000).fadeIn(200);
    });
  </script>
  <style>
    body, html {
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      font-family: "Inter";
      font-weight: 500;
      margin: 2px;
      overflow: hidden;
    }

    #message {
      position: absolute;
    }

    #classroom {
      position: fixed;
      background: #000;
      color: #FFF;
      padding: 3px 8px;
      border-radius: 2.5px;
      font-size: 11px;
      text-align: center;
    }

    #subject {
      position: fixed;
      top: 30px;
      font-weight: 700;
    }

    #countdown {
      position: fixed;
      top: 30px;
      left: 200px;
    }

    #times {
      position: fixed;
      top: 55px;
    }
  </style>
</html>
